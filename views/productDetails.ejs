<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="/ishtri1.png" sizes="16x16 32x32" type="image/png"> <!-- Use root-relative path -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO and Social Media Meta Tags -->
    <!-- Title Tag: Be concise and descriptive. Use product name if available. -->
    <title><%= typeof product !== 'undefined' ? `${product.ProductName} in ${product.Location} - ${product.category} | Ishtri` : 'Product Details | Ishtri' %></title>

    <!-- Meta Description: Summarize the page content for search engines. -->
    <meta name="description" content="<%= typeof product !== 'undefined' ? `Find a great deal on a ${product.ProductName} located in ${product.Location}. See photos, price of ${product.Price}$, and contact the seller directly on Ishtri.` : 'Explore product details on Ishtri.' %>">

    <!-- Keywords: Relevant terms for search. -->
    <meta name="keywords" content="<%= typeof product !== 'undefined' ? product.ProductName + ', ' + product.category + ', buy, sell, marketplace, Ishtri' : 'product details, marketplace, buy, sell, Ishtri' %>">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="product">
    <meta property="og:url" content="<%= typeof product !== 'undefined' ? 'https://ishtri.site/productDetails?productdID=' + product.ProductdID : 'https:/ishtri.site' %>"> <!-- Replace with actual domain and URL -->
    <meta property="og:title" content="<%= typeof product !== 'undefined' ? product.ProductName + ' | Ishtri' : 'Product Details | Ishtri' %>">
    <meta property="og:description" content="<%= typeof product !== 'undefined' ? 'View details for ' + product.ProductName + '.' : 'Explore product details on Ishtri.' %>">
    <!-- Use the first product image for OG image if available -->
    <meta property="og:image" content="<%= typeof product !== 'undefined' && product.Images && product.Images.split(',').length > 0 ? baseUrl + '/uploads/' + product.Images.split(',')[0].trim() : baseUrl + '/images/default-product.png' %>"> <!-- Replace with actual domain/path -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="<%= typeof product !== 'undefined' ? 'https://ishtri.site/productDetails?productdID=' + product.ProductdID : 'https://ishtri.site' %>"> <!-- Replace with actual domain and URL -->
    <meta property="twitter:title" content="<%= typeof product !== 'undefined' ? product.ProductName + ' | Ishtri' : 'Product Details | Ishtri' %>">
    <meta property="twitter:description" content="<%= typeof product !== 'undefined' ? 'View details for ' + product.ProductName + '.' : 'Explore product details on Ishtri.' %>">
    <!-- Use the first product image for Twitter image if available -->
    <meta property="twitter:image" content="<%= typeof product !== 'undefined' && product.Images && product.Images.split(',').length > 0 ? '/uploads/' + product.Images.split(',')[0].trim() : '/images/default-product.png' %>"> <!-- Replace with actual domain/path -->

    <!-- Other Meta Tags -->
    <meta name="robots" content="index, follow"> <!-- Allow search engines to index -->
    <link rel="canonical" href="<%= typeof product !== 'undefined' ? baseUrl + '/productDetails?productdID=' + product.ProductdID : baseUrl %>" /> <!-- Replace with actual domain and URL -->

    <!-- Stylesheets and Scripts -->
    <link rel="stylesheet" href="/css/main.css"> <!-- Use root-relative path -->

<!-- ADD THIS SCRIPT TO THE <head> of productDetails.html -->
    <% if (typeof product !== 'undefined') { %>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": "<%= product.ProductName %>",
      "image": [
        <% const images = product.Images.split(',').filter(img => img.trim()); %>
        <% images.forEach((img, index) => { %>
          "<%= baseUrl %>/uploads/<%= img.trim() %>"<%= index < images.length - 1 ? ',' : '' %>
        <% }); %>
       ],
      "description": "<%= product.Description.replace(/"/g, '\\"') %>",
      "sku": "<%= product.ProductdID %>",
      "mpn": "<%= product.ProductdID %>",
      <% if (product.brand_name) { %>
      "brand": {
        "@type": "Brand",
        "name": "<%= product.brand_name %>"
      },
      <% } %>
      "offers": {
        "@type": "Offer",
        "url": "<%= baseUrl %>/productDetails?productdID=<%= product.ProductdID %>",
        "priceCurrency": "USD", /* CHANGE TO YOUR CURRENCY (e.g., NOK) */
        "price": "<%= product.Price %>",
        "availability": "<%= product.Sold ? 'https://schema.org/SoldOut' : 'https://schema.org/InStock' %>",
        "itemCondition": "https://schema.org/UsedCondition" /* Or NewCondition, etc. */
      },
      "seller": {
        "@type": "Person", /* Or Organization */
        "name": "Seller on Ishtri" /* If you have the seller's name, use it here */
      }
    }
    </script>
    <% } %>
    
   
</head>
<body data-page="productDetails">
    <%- include('partials/navbar') %>

    <div class="page-content">
    <div id="messageModal">
        <h3>Send Message to Owner</h3>
        <textarea id="messageInput" rows="5" cols="40" placeholder="Type your message here..."></textarea>
        <br><br>
        <button id="sendMessageButton" class="btn btn-primary">Send</button>
        <button id="cancelMessageButton" class="btn btn-secondary">Cancel</button>
    </div>
    <div id="overlay"></div>

    <div class="productDetailsContainer">
        <div id="productSkeleton" class="skeleton-container">
            <div class="skeleton-image skeleton"></div>
            <div class="skeleton-title skeleton"></div>
            <div class="skeleton-price skeleton"></div>
            <div class="skeleton-location skeleton"></div>
            <div class="skeleton-description skeleton"></div>
        </div>

        <div class="carousel" id="imageCarousel" style="display: none;">
            <!-- Images will be dynamically loaded -->
            <button class="prev">❮</button>
            <button class="next">❯</button>
        </div>

        <h1 id="productTitle" style="display: none;">Product Title</h1>
        <p style="display: none;"><strong>Price</strong> <span id="productPrice"></span></p>
        <p style="display: none;"><strong data-i18n="product_details.location">Location:</strong> <span id="productLocation"></span></p>
        <p id="productDescription" style="display: none;">Product Description</p>

        <button class="btn btn-primary sendMessage" id="contactOwner" style="display: none;" data-i18n="product_details.contact_owner">Contact owner</button>
        <button id="favoriteButton" class="btn btn-primary sendMessage" style="display: none;">Favorite</button>
    </div>
    <div id="loginModal">
    <h3>You need to log in to favorite this product</h3>
    <p>Please log in to access this feature.</p>
    <div class="button-container">
        <button id="loginButton1" class="btn btn-primary">Log In</button>
        <button id="cancelLoginButton" class="btn btn-secondary">Cancel</button>
    </div>
</div>
<div id="loginOverlay"></div>

    </div>

    <div class="toast-container" id="toastContainer"></div>
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
        // No inline JavaScript - all functionality is in modular JS files
        // The productDetails page module will be loaded by app.js
    </script>
    <!-- Load Socket.IO and modular app.js -->
    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="/js/app.js"></script>
</body>
</html>
