<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" /></noscript>
    <link rel="icon" href="/ishtri1.png" sizes="16x16 32x32" type="image/png"> <!-- Use root-relative path -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" crossorigin="anonymous">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous"></noscript>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO and Social Media Meta Tags -->
    <!-- Title Tag: Make it dynamic based on the category -->
    <title><%= typeof category !== 'undefined' ? category : 'Products' %> | Ishtri Marketplace</title>

    <!-- Meta Description: Describe the category page -->
    <meta name="description" content="Discover thousands of listings for <%= typeof category !== 'undefined' ? category : 'products' %> on Ishtri. Filter by price, location, and condition to find the perfect item for you today.">
    <!-- Keywords: Include category and related terms -->
    <meta name="keywords" content="<%= typeof category !== 'undefined' ? category : 'products' %>, Ishtri, marketplace, buy, sell, filter, sort, <%= typeof category !== 'undefined' ? category.toLowerCase() : '' %> listings">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <!-- Construct URL dynamically if possible -->
    <meta property="og:url" content="https://ishtri.site/torgetkat?category=<%= typeof category !== 'undefined' ? category : '' %>"> <!-- Replace with actual domain -->
    <meta property="og:title" content="<%= typeof category !== 'undefined' ? category : 'Products' %> | Ishtri Marketplace">
    <meta property="og:description" content="Browse and filter products in the <%= typeof category !== 'undefined' ? category : 'selected' %> category on Ishtri.">
    <meta property="og:image" content="<%= typeof product !== 'undefined' && product.Images && product.Images.split(',').length > 0 ? baseUrl + '/img/1200/' + product.Images.split(',')[0].trim() : baseUrl + '/images/default.svg' %>"> <!-- Replace with actual domain and path to a relevant image or logo -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content="https://ishtri.site/torgetkat?category=<%= typeof category !== 'undefined' ? category : '' %>"> <!-- Replace with actual domain -->
    <meta property="twitter:title" content="<%= typeof category !== 'undefined' ? category : 'Products' %> | Ishtri Marketplace">
    <meta property="twitter:description" content="Browse and filter products in the <%= typeof category !== 'undefined' ? category : 'selected' %> category on Ishtri.">
    <meta property="twitter:image" content="https://ishtri.site/ishtri1.png"> <!-- Replace with actual domain and path to a relevant image or logo -->

    <!-- Other Meta Tags -->
    <meta name="robots" content="index, follow"> <!-- Allow indexing of category pages -->
    <link rel="canonical" href="<%= baseUrl %>/torgetkat<%= typeof category !== 'undefined' ? ('?category=' + encodeURIComponent(category)) : '' %>" /> <!-- Category canonical -->

    <!-- Layout Shift Prevention Optimizations -->
    <%- include('partials/optimized-head') %>

    <!-- Stylesheets and Scripts -->
    <link rel="stylesheet" href="/css/main.min.css"> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js" integrity="sha512-UOJe4paV6hYWBnS0c9GnIRH8PLm2nFK22uhfAvsTIqd3uwnWsVri1OPn5fJYdLtGY3wB11LGHJ4yPU1WFJeBYQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

          
<!-- ADD THIS SCRIPT TO THE <head> of TorgetKat.html -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "Home",
    "item": "<%= baseUrl %>/"
  },{
    "@type": "ListItem",
    "position": 2,
    "name": "<%= typeof category !== 'undefined' ? category : 'Products' %>",
    "item": "<%= baseUrl %>/torgetkat?category=<%= typeof category !== 'undefined' ? category : '' %>"
  }]
}
</script>

    

</head>
<body data-page="productList">
    <%- include('partials/navbar') %>

    <!-- Filter/Sort Bar (This section is OUTSIDE the main two-column layout) -->
    <div class="filter-container-wrapper" style="margin-bottom: 20px; padding-left: 25px;">
        <button class="offcanvas-filter-btn" id="offcanvasFilterBtn" type="button">
        <i class="fas fa-filter"></i> <span data-i18n="filter.filter">Filter</span>
    </button>
        <div class="filter-container">
            <label for="priceFilter" data-i18n="filter.sorter_etter">Sort By:</label>
            <select id="priceFilter">
                <option value="asc" data-i18n="filter.lavest_pris">Lowest Price</option>
                <option value="desc" data-i18n="filter.høyest_pris">Highest Price</option>
                <option value="" data-i18n="filter.alle">All</option>
            </select>
            <label for="dateFilter" data-i18n="filter.utgitt">Date:</label>
            <select id="dateFilter">
                <option value="" data-i18n="filter.alle">All</option>
                <option value="desc" data-i18n="filter.nylige">New</option>
                <option value="asc" data-i18n="filter.eldre">Old</option>
            </select>
            <div id="subcategoryFilterContainer" style="display: none;">
                <label for="subCategoryFilter" data-i18n="form.category">Categori:</label>
                <select id="subCategoryFilter">
                    <option value="" data-i18n="filter.alle">All</option>
                    <option value="Klær" data-i18n="subkategori.klær">Clothes</option>
                    <option value="Elektronikk" data-i18n="subkategori.elektronikk">Electronics</option>
                    <option value="Hvitvarer" data-i18n="subkategori.hvitvarer">White Goods</option>
                    <option value="Møbler" data-i18n="subkategori.møbler">Furniture</option>
                    <option value="Annet" data-i18n="subkategori.annet">Else</option>
                </select>
            </div>
            <div class="filter-actions">
                      
                <button id="saveSearchBtn" class="btn btn-primary save-search-button">
                    <span class="btn-icon"><i class="fas fa-save"></i></span>
                    <span class="btn-text">Save This Search</span>
                </button>
                      
                <button class="btn btn-secondary reset-filters-btn" id="resetFiltersBtn">
                    <span class="btn-icon"></span>
                    <span class="btn-text">Reset Filters</span>
                </button>

    
            </div>
        </div>
    </div>

    <!-- Active Filters Display (This is also OUTSIDE the main two-column layout) -->
    <div class="active-filters-container" id="activeFiltersDisplay" style="display: none; margin-bottom: 15px; padding: 10px 20px;">
        <!-- Active filters will be shown here by JS -->
    </div>

    <!-- THIS IS THE MAIN TWO-COLUMN LAYOUT CONTAINER -->
    <div class="page-container">

        <!-- Child 1: The Side Panel (Left Column) -->
        <div class="side-panel" id="mainSidePanel">
            <h3 data-i18n="filter.filter_land">Filter by Country</h3>
            <ul class="country-list">
                <!-- Countries will be populated here -->
            </ul>
    
            <h3 id="filterCar">Filter by Car</h3>
            <ul class="car-brand-list" id="carBrandList">
                <!-- Car brands will be populated here -->
            </ul>

            <!-- Car Specific Filters -->
            <div id="carSpecificFilters" style="display: none;">
                <div class="filter-section">
                    <h4 data-i18n="filter.year_range">Year Range</h4>
                    <div class="slider-values"><span id="year-slider-val-min"></span> - <span id="year-slider-val-max"></span></div>
                    <div id="year-slider" class="range-slider"></div>
                    <input type="hidden" id="yearFrom">
                    <input type="hidden" id="yearTo">
                </div>
                <div class="filter-section">
                    <h4 data-i18n="filter.mileage_range">Mileage (km)</h4>
                    <div class="slider-values"><span id="mileage-slider-val-min"></span> - <span id="mileage-slider-val-max"></span></div>
                    <div id="mileage-slider" class="range-slider"></div>
                    <input type="hidden" id="mileageFrom">
                    <input type="hidden" id="mileageTo">
                </div>
                <div class="filter-section">
                    <h4 data-i18n="filter.fuel_type">Fuel Type</h4>
                    <select id="fuelTypeFilter" multiple>
                        <option value="Petrol" data-i18n="fuel.petrol">Petrol</option>
                        <option value="Diesel" data-i18n="fuel.diesel">Diesel</option>
                        <option value="Hybrid" data-i18n="fuel.hybrid">Hybrid</option>
                        <option value="Electric" data-i18n="fuel.electric">Electric</option>
                        <option value="Other" data-i18n="filter.other">Other</option>
                    </select>
                </div>
                <div class="filter-section">
                    <h4>Transmission</h4>
                    <select id="transmissionFilter" multiple>
                        <option value="Manual">Manual</option>
                        <option value="Automatic">Automatic</option>
                    </select>
                </div>
            </div>

            <!-- Property Specific Filters -->
            <div id="propertySpecificFilters" style="display: none;">
                <div class="filter-section">
                    <h4>Property Type</h4>
                    <select id="propertyTypeFilter" multiple>
                        <option value="Apartment">Apartment</option>
                        <option value="House">House</option>
                        <option value="Cabin">Cabin</option>
                        <option value="Townhouse">Townhouse</option>
                        <option value="Commercial">Commercial</option>
                    </select>
                </div>
                <div class="filter-section">
                    <h4>Size (m²)</h4>
                    <div class="slider-values"><span id="size-slider-val-min"></span> - <span id="size-slider-val-max"></span></div>
                    <div id="size-slider" class="range-slider"></div>
                    <input type="hidden" id="sizeSqmFrom">
                    <input type="hidden" id="sizeSqmTo">
                </div>
                <div class="filter-section">
                    <h4>Number of Rooms</h4>
                    <div class="slider-values"><span id="rooms-slider-val-min"></span> - <span id="rooms-slider-val-max"></span></div>
                    <div id="rooms-slider" class="range-slider"></div>
                    <input type="hidden" id="numRoomsFrom">
                    <input type="hidden" id="numRoomsTo">
                </div>
                <div class="filter-section">
                    <h4>Number of Bathrooms</h4>
                    <div class="slider-values"><span id="bathrooms-slider-val-min"></span> - <span id="bathrooms-slider-val-max"></span></div>
                    <div id="bathrooms-slider" class="range-slider"></div>
                    <input type="hidden" id="numBathroomsFrom">
                    <input type="hidden" id="numBathroomsTo">
                </div>
                <div class="filter-section">
                    <h4>Energy Class</h4>
                    <select id="energyClassFilter" multiple>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                    </select>
                </div>
            </div>

            <!-- Work Specific Filters -->
            <div id="workSpecificFilters" style="display: none;">
                <div class="filter-section">
                    <h4>Employment Type</h4>
                    <select id="employmentTypeFilter" multiple>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contract">Contract</option>
                        <option value="Temporary">Temporary</option>
                        <option value="Internship">Internship</option>
                    </select>
                </div>
                <div class="filter-section">
                    <h4>Salary Range (NOK)</h4>
                    <div class="range-inputs">
                        <input type="number" id="salaryFrom" placeholder="From" min="0">
                        <input type="number" id="salaryTo" placeholder="To">
                    </div>
                </div>
                <div class="filter-section">
                    <h4>Application Deadline</h4>
                    <div class="date-input">
                        <input type="date" id="deadlineDate">
                    </div>
                </div>
            </div>
             <!-- START: Added Action Buttons for Mobile -->
            <div class="offcanvas-actions">
                      
            <button id="saveSearchBtn-mobile" class="btn btn-primary save-search-button">
                <span class="btn-icon"><i class="fas fa-save"></i></span>
                <span class="btn-text" data-i18n="filter.save_search">Save This Search</span>
            </button>

                     
                      
            <button class="btn btn-secondary reset-filters-btn" id="resetFiltersBtn-mobile">
                <span class="btn-icon"></span>
                <span class="btn-text" data-i18n="filter.reset_filters">Reset Filters</span>
            </button>

    
            </div>
        </div>

        <!-- Child 2: The Products Container (Right Column) -->
        <div class="productsContainer product-grid" id="productsContainer">
            <!-- Skeleton loading while products load -->
            <div class="skeleton-product skeleton-container">
                <div class="skeleton-image-container">
                    <div class="skeleton-image skeleton"></div>
                </div>
                <div class="skeleton-content">
                    <div class="skeleton-header">
                        <div class="skeleton skeleton-title"></div>
                        <div class="skeleton skeleton-price"></div>
                    </div>
                    <div class="skeleton-details">
                        <div class="skeleton skeleton-text" style="width: 60%;"></div>
                        <div class="skeleton skeleton-text" style="width: 45%;"></div>
                        <div class="skeleton skeleton-location"></div>
                    </div>
                </div>
            </div>
            <div class="skeleton-product skeleton-container">
                <div class="skeleton-image-container">
                    <div class="skeleton-image skeleton"></div>
                </div>
                <div class="skeleton-content">
                    <div class="skeleton-header">
                        <div class="skeleton skeleton-title"></div>
                        <div class="skeleton skeleton-price"></div>
                    </div>
                    <div class="skeleton-details">
                        <div class="skeleton skeleton-text" style="width: 60%;"></div>
                        <div class="skeleton skeleton-text" style="width: 45%;"></div>
                        <div class="skeleton skeleton-location"></div>
                    </div>
                </div>
            </div>
            <div class="skeleton-product skeleton-container">
                <div class="skeleton-image-container">
                    <div class="skeleton-image skeleton"></div>
                </div>
                <div class="skeleton-content">
                    <div class="skeleton-header">
                        <div class="skeleton skeleton-title"></div>
                        <div class="skeleton skeleton-price"></div>
                    </div>
                    <div class="skeleton-details">
                        <div class="skeleton skeleton-text" style="width: 60%;"></div>
                        <div class="skeleton skeleton-text" style="width: 45%;"></div>
                        <div class="skeleton skeleton-location"></div>
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- End of .page-container -->

    <!-- Off-Canvas and other utility elements -->
    <div class="offcanvas-filter-overlay" id="offcanvasFilterOverlay"></div>
    <aside class="offcanvas-filter-drawer" id="offcanvasFilterDrawer" aria-modal="true" role="dialog" tabindex="-1">
        <div class="offcanvas-filter-header">
            <span class="offcanvas-filter-title"><i class="fas fa-filter"></i> <span data-i18n="filter.filters">Filters</span></span>
            <button class="offcanvas-filter-close" id="offcanvasFilterClose" aria-label="Close Filters">×</button>
        </div>
        <div class="offcanvas-filter-content">
            <div id="offcanvasSidePanel">
                <!-- Will be filled by JS with .side-panel content -->
            </div>
        </div>
    </aside>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    <div class="toast-container" id="toastContainer"></div>
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>
    
    <!-- Layout Shift Prevention Scripts -->
    <%- include('partials/optimized-scripts') %>
    
    <script type="module" src="/js/app.js"></script>
</body>
</html>